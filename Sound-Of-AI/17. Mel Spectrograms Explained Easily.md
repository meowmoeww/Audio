### Psychoacoustic experiment

- 1st sample : C2 - C4 → (65 ` 262HZ)
- 2st sample : G6 - A6 → ( 1568 -1760Hz)

첫번째 샘플과 두번째 샘플에서 각 노트간의 주파수 차이는 200Hz이지만, 실제로 들었을 때는 둘 다 200Hz 차이인 것처럼 느껴지지 않는다

“Humans perceive frequency logarithmically” : 바닐라 스펙트럼에서  주파수는 선형으로 설명되는데, 인간이 주파수를 인식할 때 선형으로 인식하지 않는다. 

### 이상적인 오디오 특징

- 시간 - 주파수의 표현이다
- 인간이 듣고 이해하기 편한 방식으로 진폭을 표현
- 인간이 듣고 이해하기 편한 방식으로 주파수를 표현

→ 인간의 청각 인식에 기반한 정보를 제공하기 위하여, 스펙트로그램과 멜의 개념이 합친 Mel spectrograms이 나오게 된다 

### Mel-scale

: 멜 스케일(Mel scale)은 주파수를 로그 스케일로 변환한 것으로, 인간의 청각 인식을 반영하기 위해 사용된다. 이는 인간이 높은 주파수에 덜 민감하고 낮은 주파수에 민감하다는 사실을 반영한 것이다. 

멜 스케일은 높은 주파수에서는 더 넓은 간격으로, 낮은 주파수에서는 더 좁은 간격으로 주파수를 표현하여 인간의 청각 인식과 비슷한 방식으로 소리의 주파수를 나타낸다. 

- 로그 스케일의 값을 사용한다
- 1000 Hz의 소리는 1000 Mel로 정의됩니다. 이는 1000 Hz 이하에서는 주파수와 멜이 거의 동일하게 느껴진다는 경험적 관찰에 기반한다. 다만, 1000 Hz를 넘어서면 멜 값은 로그 스케일로 증가하여, 같은 주파수 차이가 더 큰 멜 차이로 느껴지게 된다
- 주파수 간의 멜 단위가 동일한 간격을 가질 때, 이는 인간에게 같은 '지각적인' 거리로 인식된다.. 멜 스케일은 주파수의 절대적인 차이가 아니라, 인간이 어떻게 그 차이를 인식하는지를 나타내는 척도이다

주파수가 주어졌을 때 Mel을 구하거나, Mel이 주어졌을 때 주파수를 구하기 위해서는 아래의 식을 이용하면 된다.

![image](https://github.com/meowmoeww/Audio/assets/89447043/4192f095-1c29-46cd-ac16-1f4bd9a203ba)

### Recipe to extract Mel spectrogram

1. STFT를 추출한다 

오디오 신호에서 짧은 시간 구간에 대해 푸리에 변환을 수행하여시간-주파수 영역에서의 스펙트로그램을 얻는다. 

2. 진폭을 DBs로 변환한다.

 STFT로부터 얻은 스펙트로그램의 진폭 값을 데시벨 단위로 변환한다.

3. 스펙트로그램의 주파수를 Mel scale의 표현으로 변환한다. 

스펙트로그램의 주파수 축을 멜 스케일로 매핑하여 인간의 청각 반응을 더 잘 반영하도록 한다.

### How many mel bands?

멜 스펙트로그램을 만들 때 멜 밴드(mel bands)의 수는 선택된 문제에 따라 다르다. 일반적으로 40, 60, 90, 128 등과 같은 다양한 밴드 수가 사용되지만 밴드의 수는 주어진 응용 분야의 요구사항과 처리하려는 오디오 신호의 특성에 따라 결정된다. 

### convert frequencies to Mel scale

1. 멜 밴드들의 갯수를 정한다.

분석하고자 하는 오디오 신호의 특성과 응용 프로그램의 요구사항에 따라 사용할 멜 밴드의 수를 결정한다. 

2. mel filter banks를 구축한다

결정된 멜 밴드 수에 기반하여 멜 스케일에 맞는 필터 뱅크를 만든다. 이 필터 뱅크는 각각의 멜 밴드에 해당하는 주파수 범위에 대해 필터링을 수행하도록 설계된다.

3. 스펙트로그램에 mel filter를 적용한다. 

구축된 멜 필터 뱅크를 STFT 스펙트로그램에 적용하여, 각 멜 밴드에 해당하는 에너지를 추출하면 멜 스펙트로그램을 얻게 된다. 

### Mel filter banks

1. 주파수 범위의 양 끝을 멜 스케일로 변환한다. 이는 분석할 주파수 범위를 설정하는 단계이다. 

![image](https://github.com/meowmoeww/Audio/assets/89447043/22427f4b-720d-44f4-b545-85cd08fa555c)

2. 주파수 영역을 일정한 간격으로 나누기 (왼쪽 초록색 점은 가장 낮은 주파수, 오른쪽 초록색 점은 가장 높은 주파수)
    
    이는 주파수 분석을 위해 필요한 밴드의 개수와 그 간격을 결정하는 중요한 단계 중 하나이다 
    

![image](https://github.com/meowmoeww/Audio/assets/89447043/68b57b1f-5906-4a36-8894-49a358d6d958)

3. 멜 스케일 상의 주파수 포인트를 다시 헤르츠로 변환을 한다. 이러한 변환을 통해 실제 주파수 영역에 멜 필터 뱅크를 적용할 수 있게 된다. 

![image](https://github.com/meowmoeww/Audio/assets/89447043/523ac170-d82f-4639-affd-6eb42db35097)

4. 연속적인 주파수가 아닌 이산적인 주파수 빈를 사용하기 때문에 계산된 주파수 포인트를 실제로 가장 가까운 주파수 빈 값으로 올림하여 조정한다. 
5. 주파수 영역을 일정한 간격으로 나누어 각 구간에 대응하는 필터를 생성한다. 이는 주파수 영역에서 특정 주파수 대역의 신호를 추출하거나 강조하는 데 사용된다. 이산 신호를 다룰 때에는 주파수 영역을 이산화하여 각 구간을 삼각형 모양의 필터로 표현하는 것이 일반적이다. 

![image](https://github.com/meowmoeww/Audio/assets/89447043/d1f6a0ba-1072-4321-8ecb-4b535992708c)

### Mel filter bank’s shape

(#bands, framesize/2 +1)

### Convert frequencies to Mel scale

앞에서 말한 3번 “ spectrogram에 멜 필터를 적용한다” 과연 이걸 어떻게 스펙트로그램에 적용할까?

### Applying mel filter banks to spectrogram

멜 필터와 스펙트로그램은 아래와 같은 사이즈를 가지고 있다.

M = (#bands, framsize/2 +1) 

Y = (framesize /2 +1 , # frames)

M 행렬의 열수와, Y 행렬의 행수가 동일하기 때문에, 둘 사이에 행렬곱셉을 진행하면 이는 멜필터를 스펙트로그램에 적용하는 것이다. 

Mel spectrogram = MY

(#bands , # frames) 그럼 둘의 곱의 연산의 결과는 다음과 같은 사이즈를 가지게 된다. 

![image](https://github.com/meowmoeww/Audio/assets/89447043/4cc1b1cb-d7cd-43ce-98b9-487a0fa5cbef)

멜 스펙트로그램은 x축이 시간, y축이 주파수이다. 다만 이 주파수는 스펙트로그램에 사용되는 주파수가 아닌, 멜 필터를 적용한 주파수의 결과이다. 

### Mel spectrogram applications

많은 AI 오디오 개발에 멜 스펙트그램이 사용된다

- audio classification
- automatic mood recognition
- Music genre classification
- Music instrument classification
